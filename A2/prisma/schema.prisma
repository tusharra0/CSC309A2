datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

generator client {
  provider = "prisma-client-js"
}

enum RoleType {
  regular
  cashier
  manager
  superuser
}

enum TransactionType {
  purchase
  redemption
  adjustment
  event
  transfer
}

enum PromotionType {
  automatic
  onetime
}

model User {
  id       Int    @id @default(autoincrement())
  utorid   String @unique
  email    String @unique
  name     String
  password String
  role String @default("regular")
  verified Boolean @default(false)
  expiresAt DateTime
  resetToken String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  points               Int       @default(0)
  birthday             DateTime?
  lastLogin            DateTime?
  avatarUrl            String?
  promotions           UserPromotion[]
}

model Promotion {
  id           Int              @id @default(autoincrement())
  name         String
  type         PromotionType
  minSpending  Int?
  rate         Float?
  points       Int?
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt
  assignments  UserPromotion[]
}

model UserPromotion {
  id           Int        @id @default(autoincrement())
  user         User       @relation(fields: [userId], references: [id])
  userId       Int
  promotion    Promotion  @relation(fields: [promotionId], references: [id])
  promotionId  Int
  used         Boolean    @default(false)
  usedAt       DateTime?
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt

  @@unique([userId, promotionId])
}
